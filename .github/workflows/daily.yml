name: daily
on: 
  push:
    branches: 
      - 'main'
  schedule:
    - cron: '0 12 * * *'

jobs:
  run-python-script: 
    runs-on: ubuntu-latest
    env:
      ENVIRONMENT: production
    steps: 
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up python 
        uses: actions/setup-python@v2
        with:
          python-version: '3.12'
      
      - name: Install Python dependencies
        run: python -m pip install --upgrade pip && pip install -r requirements.txt

      - name: Add credentials.json 
        run: echo "$CREDENTIALS_JSON" > credentials.json 
        env:
          CREDENTIALS_JSON: ${{ env.CREDENTIALS_JSON }}

      - name: Debug
        run: echo "Length of CREDENTIALS_JSON is ${#CREDENTIALS_JSON}"
        env:
          CREDENTIALS_JSON: ${{ env.CREDENTIALS_JSON }}
          
      
      - name: Run Python script 
        run: python main.py
        env:
          SLACK_APP_TOKEN: ${{ env.SLACK_APP_TOKEN }}
          CREDENTIALS_JSON: ${{ env.CREDENTIALS_JSON }}
          
      
  
